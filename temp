<dashboard>
  <label>Method Execution Time Dashboard</label>
  <description>Dashboard to monitor method execution times and drill down to detailed logs.</description>
  <row>
    <panel>
      <input type="time" token="time_range">
        <default>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </default>
      </input>
      
      <!-- Dropdown for sourcetype filter -->
      <input type="dropdown" token="sourcetype_filter">
        <label>Select Source Type:</label>
        <choice value="*">All Source Types</choice>
        <choice value="a">Source Type A</choice>
        <choice value="b">Source Type B</choice>
        <choice value="c">Source Type C</choice>
        <default>*</default> <!-- Default selection -->
      </input>
    </panel>
  </row>
  <row>
    <panel>
      <title>Average Execution Time by Method</title>
      <chart>
        <search>
          <query>
            <![CDATA[
            index=<your_index> sourcetype="foo.$sourcetype_filter$.bin"
            earliest=$time_range.earliest$ latest=$time_range.latest$ 
            | rex field=_raw "start\\[(?P<start>\\d+)\\] time\\[(?P<execution_time>\\d+)\\] tag\\[(?P<tag>[^\\]]+)\\] message\\[(?P<message>[^\\]]+)\\]"
            | stats avg(execution_time) as avg_time, min(execution_time) as min_time, max(execution_time) as max_time by tag
            | sort -avg_time
            ]]>
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.series">multi</option>
        <option name="charting.axisTitleY">Execution Time (ms)</option>
        <drilldown>
          <set token="selected_tag">$row.tag$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <!-- Debugging Panel for selected_tag Token -->
  <row>
    <panel>
      <title>Debug: Selected Tag</title>
      <table>
        <search>
          <query>
            | makeresults
            | eval selected_tag="$selected_tag$"
            | table selected_tag
          </query>
        </search>
        <depends>
          <condition token="selected_tag">*</condition>
        </depends>
        <reject>
          <condition token="selected_tag">null</condition>
        </reject>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Detailed Logs for Selected Method</title>
      <table>
        <search>
          <query>
            <![CDATA[
            index=<your_index> sourcetype="foo.$sourcetype_filter$.bin"
            earliest=$time_range.earliest$ latest=$time_range.latest$ 
            | rex field=_raw "start\\[(?P<start>\\d+)\\] time\\[(?P<execution_time>\\d+)\\] tag\\[(?P<tag>[^\\]]+)\\] message\\[(?P<message>[^\\]]+)\\]"
            | search tag="$selected_tag$"
            | table _time execution_time tag message
            ]]>
          </query>
        </search>
        <depends>
          <condition token="selected_tag">*</condition>
        </depends>
        <reject>
          <condition token="selected_tag">null</condition>
        </reject>
        <earliest>$time_range.earliest$</earliest>
        <latest>$time_range.latest$</latest>
      </table>
    </panel>
  </row>
</dashboard>
